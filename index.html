<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NOPE - Jejak</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#000000" />
  
  <!-- Load Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    :root {
      --deep-black: #000000;
      --white: #ffffff;
      --accent-blue: #4903fc;
      --logo-red: #ff9999;
      --border-radius: 12px;
      --gray-800: #1a1a1a;
      --gray-600: #333333;
      --gray-400: #666666;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    
    body {
      background-color: var(--deep-black);
      color: var(--white);
      min-height: 100vh;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Header Styles */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-top: 10px;
    }
    
    .logo {
      font-size: 28px;
      font-weight: 700;
      color: var(--logo-red);
    }
    
    .greeting {
      font-size: 18px;
      color: var(--white);
    }
    
    /* Navigation Tabs */
    .nav-tabs {
      display: flex;
      gap: 16px;
      margin-bottom: 30px;
      border-bottom: 1px solid var(--gray-600);
      padding-bottom: 8px;
    }
    
    .nav-tab {
      padding: 8px 16px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      color: var(--gray-400);
      transition: all 0.2s ease;
      border-bottom: 3px solid transparent;
    }
    
    .nav-tab.active {
      color: var(--accent-blue);
      border-bottom-color: var(--accent-blue);
    }
    
    /* Main Artefak Section */
    .main-artefak-container {
      margin-bottom: 40px;
    }
    
    .main-artefak-label {
      font-size: 14px;
      color: var(--gray-400);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .main-artefak {
      width: 100%;
      aspect-ratio: 1/1.428; /* Tinggi = 0.04 dari lebar (1/0.7 ‚âà 1.428) */
      position: relative;
      border-radius: var(--border-radius);
      overflow: hidden;
      background: var(--gray-800);
      border: 1px solid var(--gray-600);
    }
    
    .main-artefak-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    
    .main-artefak-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px;
      text-align: center;
    }
    
    .placeholder-icon {
      font-size: 48px;
      color: var(--gray-600);
      margin-bottom: 16px;
    }
    
    .placeholder-text {
      color: var(--gray-400);
      font-size: 16px;
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    /* Notasi Style */
    .notasi {
      position: absolute;
      top: 16px;
      left: 16px;
      background: rgba(0, 0, 0, 0.85);
      color: var(--white);
      font-size: 14px;
      padding: 8px 16px;
      border-radius: 20px;
      max-width: calc(100% - 32px);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: 500;
      letter-spacing: 0.5px;
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Upload Button */
    .upload-btn {
      background: var(--accent-blue);
      color: var(--white);
      border: none;
      border-radius: 25px;
      padding: 14px 32px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 180px;
    }
    
    .upload-btn:hover:not(:disabled) {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    
    .upload-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .upload-btn.uploaded {
      background: #10b981;
    }
    
    /* Cooldown Timer */
    .cooldown-info {
      margin-top: 12px;
      font-size: 13px;
      color: var(--gray-400);
      text-align: center;
    }
    
    .cooldown-timer {
      color: var(--accent-blue);
      font-weight: 600;
    }
    
    /* Artefak History */
    .history-section {
      margin-top: 40px;
    }
    
    .history-label {
      font-size: 14px;
      color: var(--gray-400);
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .history-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    
    .history-card {
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      background: var(--gray-800);
      position: relative;
      border: 1px solid var(--gray-600);
    }
    
    .history-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .history-notasi {
      position: absolute;
      bottom: 8px;
      left: 8px;
      right: 8px;
      background: rgba(0, 0, 0, 0.8);
      color: var(--white);
      font-size: 10px;
      padding: 4px 8px;
      border-radius: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .history-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--gray-600);
      font-size: 24px;
    }
    
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .modal-content {
      background: var(--gray-800);
      border-radius: var(--border-radius);
      width: 100%;
      max-width: 400px;
      border: 1px solid var(--gray-600);
    }
    
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid var(--gray-600);
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--white);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-footer {
      padding: 20px;
      border-top: 1px solid var(--gray-600);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }
    
    .modal-btn {
      padding: 10px 20px;
      border-radius: 20px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .modal-btn.primary {
      background: var(--accent-blue);
      color: var(--white);
    }
    
    .modal-btn.secondary {
      background: transparent;
      color: var(--gray-400);
      border: 1px solid var(--gray-600);
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      color: var(--gray-400);
      font-size: 14px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: var(--gray-600);
      border: 1px solid var(--gray-400);
      border-radius: 8px;
      color: var(--white);
      font-size: 16px;
    }
    
    .form-input::placeholder {
      color: var(--gray-400);
    }
    
    .file-input-label {
      display: block;
      width: 100%;
      aspect-ratio: 1/1.428;
      background: var(--gray-600);
      border: 2px dashed var(--gray-400);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    
    .file-input-label:hover {
      border-color: var(--accent-blue);
    }
    
    .file-input-icon {
      font-size: 48px;
      color: var(--gray-400);
      margin-bottom: 16px;
    }
    
    .file-input-text {
      color: var(--gray-400);
      font-size: 16px;
      text-align: center;
    }
    
    .file-input {
      display: none;
    }
    
    .preview-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }
    
    /* Utility Classes */
    .hidden {
      display: none;
    }
    
    .text-center {
      text-align: center;
    }
    
    .mt-4 {
      margin-top: 16px;
    }
    
    .mb-4 {
      margin-bottom: 16px;
    }
    
    /* Tab Content */
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">NOPE</div>
      <div class="greeting" id="greeting">Hello @user</div>
    </div>
    
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <div class="nav-tab active" data-tab="jejak">Jejak</div>
      <div class="nav-tab" data-tab="jalan">Jalan</div>
      <div class="nav-tab" data-tab="dunia">Dunia</div>
      <div class="nav-tab" data-tab="jelajah">Jelajah</div>
    </div>
    
    <!-- Jejak Tab Content -->
    <div id="jejak-tab" class="tab-content active">
      <!-- Main Artefak Section -->
      <div class="main-artefak-container">
        <div class="main-artefak-label">Artefak Bulan Ini</div>
        <div class="main-artefak" id="main-artefak">
          <!-- Artefak utama akan dimuat di sini -->
        </div>
        
        <div class="text-center mt-4">
          <button class="upload-btn" id="upload-main-btn">
            Unggah Artefak Baru
          </button>
          <div class="cooldown-info" id="cooldown-info">
            Dapat diunggah kembali dalam: <span class="cooldown-timer" id="cooldown-timer">30 hari</span>
          </div>
        </div>
      </div>
      
      <!-- Artefak History -->
      <div class="history-section">
        <div class="history-label">Riwayat Artefak</div>
        <div class="history-grid" id="history-grid">
          <!-- Riwayat artefak akan dimuat di sini -->
        </div>
      </div>
    </div>
    
    <!-- Other Tabs (Placeholder) -->
    <div id="jalan-tab" class="tab-content">
      <div style="text-align: center; padding: 60px 20px; color: var(--gray-400);">
        üõ£Ô∏è Halaman Jalan akan segera hadir
      </div>
    </div>
    
    <div id="dunia-tab" class="tab-content">
      <div style="text-align: center; padding: 60px 20px; color: var(--gray-400);">
        üåç Halaman Dunia akan segera hadir
      </div>
    </div>
    
    <div id="jelajah-tab" class="tab-content">
      <div style="text-align: center; padding: 60px 20px; color: var(--gray-400);">
        üî≠ Halaman Jelajah akan segera hadir
      </div>
    </div>
  </div>
  
  <!-- Upload Modal -->
  <div id="upload-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Unggah Artefak Jejak</div>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <div class="form-label">Pilih Foto (Benda, bukan wajah)</div>
          <label class="file-input-label" id="file-input-label">
            <div class="file-input-icon">üì∑</div>
            <div class="file-input-text">Tap untuk memilih foto</div>
            <div class="file-input-text" style="font-size: 12px; margin-top: 8px;">
              Ukuran optimal: tinggi 70% dari lebar
            </div>
            <input type="file" id="file-input" class="file-input" accept="image/*" capture="environment">
          </label>
          <div id="image-preview" class="hidden">
            <img id="preview-image" class="preview-image" alt="Preview">
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="notasi-input">
            Notasi (maksimal 4 kata)
            <span id="word-count" style="float: right; color: var(--gray-400);">0/4</span>
          </label>
          <input type="text" id="notasi-input" class="form-input" 
                 placeholder="Contoh: Buku Harian Senja" maxlength="30">
          <div style="font-size: 12px; color: var(--gray-400); margin-top: 4px;">
            Notasi akan muncul di kiri atas foto
          </div>
        </div>
        
        <div class="form-group">
          <div style="font-size: 12px; color: var(--accent-blue); padding: 12px; background: rgba(73, 3, 252, 0.1); border-radius: 8px;">
            ‚è≥ Artefak Jejak hanya dapat diubah setiap 30 hari sekali. Pilih foto yang berarti!
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" id="cancel-btn">Batal</button>
        <button class="modal-btn primary" id="submit-btn" disabled>Unggah</button>
      </div>
    </div>
  </div>

  <script>
    // ============ KONFIGURASI ============
    const SUPABASE_URL = 'https://nmgquhrqfdbhhmcntrwx.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5tcWN1aHJxZmRiaGhtY250cnd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzUwNTQzMzMsImV4cCI6MjA1MDYzMDMzM30.eL7W8b4K7rN7vT8tDf9P3e3o1gXz3V3m';
    
    // ============ VARIABEL GLOBAL ============
    let supabaseClient = null;
    let currentUser = null;
    let currentMainArtefak = null;
    let artefakHistory = [];
    let selectedFile = null;
    
    // ============ ELEMENTS ============
    const elements = {
      // Header
      greeting: document.getElementById('greeting'),
      
      // Navigation
      navTabs: document.querySelectorAll('.nav-tab'),
      tabContents: document.querySelectorAll('.tab-content'),
      
      // Jejak Tab
      mainArtefak: document.getElementById('main-artefak'),
      uploadMainBtn: document.getElementById('upload-main-btn'),
      cooldownInfo: document.getElementById('cooldown-info'),
      cooldownTimer: document.getElementById('cooldown-timer'),
      historyGrid: document.getElementById('history-grid'),
      
      // Upload Modal
      uploadModal: document.getElementById('upload-modal'),
      fileInputLabel: document.getElementById('file-input-label'),
      fileInput: document.getElementById('file-input'),
      imagePreview: document.getElementById('image-preview'),
      previewImage: document.getElementById('preview-image'),
      notasiInput: document.getElementById('notasi-input'),
      wordCount: document.getElementById('word-count'),
      cancelBtn: document.getElementById('cancel-btn'),
      submitBtn: document.getElementById('submit-btn')
    };
    
    // ============ INITIALIZE ============
    async function initializeApp() {
      console.log('üöÄ Initializing NOPE Jejak...');
      
      try {
        // 1. Cek Supabase
        if (typeof supabase === 'undefined') {
          throw new Error('Supabase library not loaded!');
        }
        
        // 2. Inisialisasi Supabase Client
        supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        console.log('‚úÖ Supabase initialized');
        
        // 3. Setup Event Listeners
        setupEventListeners();
        
        // 4. Cek Session (gunakan localStorage untuk demo)
        const savedUser = localStorage.getItem('nope_user');
        if (savedUser) {
          currentUser = JSON.parse(savedUser);
          elements.greeting.textContent = `Hello @${currentUser.username}`;
          await loadJejakData();
        } else {
          // Auto login untuk demo (bisa diganti dengan form login)
          currentUser = {
            username: 'senja nope',
            id: 'senja_nope'
          };
          localStorage.setItem('nope_user', JSON.stringify(currentUser));
          elements.greeting.textContent = `Hello @${currentUser.username}`;
          await loadJejakData();
        }
        
        // 5. Update cooldown timer
        updateCooldownTimer();
        
      } catch (error) {
        console.error('‚ùå Initialization error:', error);
        alert('Gagal memuat aplikasi. Silakan refresh halaman.');
      }
    }
    
    // ============ EVENT LISTENERS ============
    function setupEventListeners() {
      // Navigation Tabs
      elements.navTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Update active tab
          elements.navTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // Show corresponding content
          elements.tabContents.forEach(content => content.classList.remove('active'));
          document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
        });
      });
      
      // Upload Button
      elements.uploadMainBtn.addEventListener('click', () => {
        if (elements.uploadMainBtn.classList.contains('uploaded')) {
          alert('Anda sudah mengunggah artefak bulan ini. Tunggu 30 hari untuk mengubahnya.');
          return;
        }
        showUploadModal();
      });
      
      // File Input
      elements.fileInput.addEventListener('change', handleFileSelect);
      
      // Notasi Input
      elements.notasiInput.addEventListener('input', updateWordCount);
      
      // Modal Buttons
      elements.cancelBtn.addEventListener('click', hideUploadModal);
      elements.submitBtn.addEventListener('click', submitArtefak);
    }
    
    // ============ JEJAK DATA MANAGEMENT ============
    async function loadJejakData() {
      try {
        // Load main artefak
        const { data: mainData, error: mainError } = await supabaseClient
          .from('artefaks')
          .select('*')
          .eq('user_id', currentUser.id)
          .eq('category', 'jejak')
          .eq('is_main', true)
          .order('created_at', { ascending: false })
          .limit(1)
          .single();
        
        if (!mainError && mainData) {
          currentMainArtefak = mainData;
          renderMainArtefak(mainData);
          elements.uploadMainBtn.textContent = 'Artefak Terunggah';
          elements.uploadMainBtn.classList.add('uploaded');
          elements.uploadMainBtn.disabled = true;
        } else {
          renderMainArtefakPlaceholder();
          elements.uploadMainBtn.textContent = 'Unggah Artefak Baru';
          elements.uploadMainBtn.classList.remove('uploaded');
          elements.uploadMainBtn.disabled = false;
        }
        
        // Load history
        const { data: historyData, error: historyError } = await supabaseClient
          .from('artefaks')
          .select('*')
          .eq('user_id', currentUser.id)
          .eq('category', 'jejak')
          .eq('is_main', false)
          .order('created_at', { ascending: false })
          .limit(9);
        
        if (!historyError && historyData) {
          artefakHistory = historyData;
          renderHistoryGrid(historyData);
        } else {
          renderHistoryGrid([]);
        }
        
      } catch (error) {
        console.error('‚ùå Error loading jejak data:', error);
        renderMainArtefakPlaceholder();
        renderHistoryGrid([]);
      }
    }
    
    function renderMainArtefak(artefak) {
      elements.mainArtefak.innerHTML = '';
      
      const img = document.createElement('img');
      img.className = 'main-artefak-image';
      img.src = artefak.image_url;
      img.alt = artefak.notasi;
      
      const notasi = document.createElement('div');
      notasi.className = 'notasi';
      notasi.textContent = artefak.notasi;
      
      elements.mainArtefak.appendChild(img);
      elements.mainArtefak.appendChild(notasi);
    }
    
    function renderMainArtefakPlaceholder() {
      elements.mainArtefak.innerHTML = `
        <div class="main-artefak-placeholder">
          <div class="placeholder-icon">üì∏</div>
          <div class="placeholder-text">
            Belum ada artefak Jejak.<br>
            Unggah foto benda pertama Anda!
          </div>
        </div>
      `;
    }
    
    function renderHistoryGrid(history) {
      elements.historyGrid.innerHTML = '';
      
      // Buat 9 slot (3x3 grid)
      for (let i = 0; i < 9; i++) {
        const card = document.createElement('div');
        card.className = 'history-card';
        
        if (i < history.length) {
          const artefak = history[i];
          card.innerHTML = `
            <img src="${artefak.image_url}" alt="${artefak.notasi}">
            <div class="history-notasi">${artefak.notasi}</div>
          `;
        } else {
          card.innerHTML = `
            <div class="history-placeholder">‚Äî</div>
          `;
        }
        
        elements.historyGrid.appendChild(card);
      }
    }
    
    // ============ UPLOAD MODAL ============
    function showUploadModal() {
      resetUploadForm();
      elements.uploadModal.classList.remove('hidden');
    }
    
    function hideUploadModal() {
      elements.uploadModal.classList.add('hidden');
    }
    
    function resetUploadForm() {
      selectedFile = null;
      elements.fileInput.value = '';
      elements.imagePreview.classList.add('hidden');
      elements.fileInputLabel.classList.remove('hidden');
      elements.notasiInput.value = '';
      updateWordCount();
      elements.submitBtn.disabled = true;
    }
    
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Validasi file
      if (!file.type.startsWith('image/')) {
        alert('Hanya file gambar yang diperbolehkan');
        return;
      }
      
      if (file.size > 10 * 1024 * 1024) { // 10MB max
        alert('Ukuran file maksimal 10MB');
        return;
      }
      
      selectedFile = file;
      
      // Tampilkan preview
      const reader = new FileReader();
      reader.onload = function(e) {
        elements.previewImage.src = e.target.result;
        elements.imagePreview.classList.remove('hidden');
        elements.fileInputLabel.classList.add('hidden');
        validateForm();
      };
      reader.readAsDataURL(file);
    }
    
    function updateWordCount() {
      const text = elements.notasiInput.value.trim();
      const wordCount = text === '' ? 0 : text.split(/\s+/).length;
      elements.wordCount.textContent = `${wordCount}/4`;
      
      // Highlight jika lebih dari 4 kata
      if (wordCount > 4) {
        elements.wordCount.style.color = '#ef4444';
      } else {
        elements.wordCount.style.color = 'var(--gray-400)';
      }
      
      validateForm();
    }
    
    function validateForm() {
      const hasFile = selectedFile !== null;
      const notasi = elements.notasiInput.value.trim();
      const wordCount = notasi === '' ? 0 : notasi.split(/\s+/).length;
      const isValid = hasFile && notasi.length > 0 && wordCount <= 4 && wordCount > 0;
      
      elements.submitBtn.disabled = !isValid;
      return isValid;
    }
    
    // ============ SUBMIT ARTEFAK ============
    async function submitArtefak() {
      if (!validateForm()) {
        alert('Harap lengkapi form dengan benar. Notasi maksimal 4 kata.');
        return;
      }
      
      if (!currentUser) {
        alert('Silakan login terlebih dahulu');
        return;
      }
      
      try {
        // Disable submit button
        elements.submitBtn.disabled = true;
        elements.submitBtn.textContent = 'Mengunggah...';
        
        // 1. Upload image to Supabase Storage
        const fileExt = selectedFile.name.split('.').pop();
        const fileName = `${currentUser.id}_jejak_${Date.now()}.${fileExt}`;
        const filePath = `jejak/${fileName}`;
        
        const { data: uploadData, error: uploadError } = await supabaseClient
          .storage
          .from('artefak')
          .upload(filePath, selectedFile, {
            cacheControl: '3600',
            upsert: false
          });
        
        if (uploadError) throw uploadError;
        
        // 2. Get public URL
        const { data: urlData } = supabaseClient
          .storage
          .from('artefak')
          .getPublicUrl(filePath);
        
        // 3. Save to database
        const now = new Date().toISOString();
        const notasi = elements.notasiInput.value.trim();
        
        // Jika ada main artefak sebelumnya, nonaktifkan
        if (currentMainArtefak) {
          await supabaseClient
            .from('artefaks')
            .update({ is_main: false })
            .eq('id', currentMainArtefak.id);
        }
        
        // Insert artefak baru
        const { data: insertData, error: insertError } = await supabaseClient
          .from('artefaks')
          .insert({
            user_id: currentUser.id,
            username: currentUser.username,
            image_url: urlData.publicUrl,
            notasi: notasi,
            category: 'jejak',
            is_main: true,
            uploaded_at: now
          })
          .select()
          .single();
        
        if (insertError) throw insertError;
        
        // 4. Update UI
        currentMainArtefak = insertData;
        renderMainArtefak(insertData);
        elements.uploadMainBtn.textContent = 'Artefak Terunggah';
        elements.uploadMainBtn.classList.add('uploaded');
        elements.uploadMainBtn.disabled = true;
        
        // 5. Update history
        await loadJejakData();
        
        // 6. Hide modal
        hideUploadModal();
        
        // 7. Show success message
        alert('‚úÖ Artefak Jejak berhasil diunggah!');
        
        // 8. Set cooldown
        setCooldown();
        
      } catch (error) {
        console.error('‚ùå Upload error:', error);
        alert('Gagal mengunggah artefak. Silakan coba lagi.');
      } finally {
        elements.submitBtn.disabled = false;
        elements.submitBtn.textContent = 'Unggah';
      }
    }
    
    // ============ COOLDOWN MANAGEMENT ============
    function setCooldown() {
      const cooldownEnd = Date.now() + (30 * 24 * 60 * 60 * 1000); // 30 hari
      localStorage.setItem('nope_cooldown_end', cooldownEnd);
      updateCooldownTimer();
    }
    
    function updateCooldownTimer() {
      const cooldownEnd = localStorage.getItem('nope_cooldown_end');
      
      if (!cooldownEnd) {
        elements.cooldownInfo.classList.add('hidden');
        return;
      }
      
      const now = Date.now();
      const endTime = parseInt(cooldownEnd);
      
      if (now < endTime) {
        const timeLeft = endTime - now;
        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        
        elements.cooldownTimer.textContent = `${days}h ${hours}j`;
        elements.cooldownInfo.classList.remove('hidden');
        
        // Jika masih dalam cooldown, disable button
        if (currentMainArtefak) {
          elements.uploadMainBtn.disabled = true;
          elements.uploadMainBtn.textContent = 'Artefak Terunggah';
        }
      } else {
        // Cooldown selesai
        localStorage.removeItem('nope_cooldown_end');
        elements.cooldownInfo.classList.add('hidden');
        
        if (currentMainArtefak) {
          elements.uploadMainBtn.disabled = false;
          elements.uploadMainBtn.textContent = 'Perbarui Artefak';
        }
      }
    }
    
    // ============ START APP ============
    document.addEventListener('DOMContentLoaded', initializeApp);
    
    // Update cooldown timer setiap menit
    setInterval(updateCooldownTimer, 60000);
  </script>
</body>
</html>
